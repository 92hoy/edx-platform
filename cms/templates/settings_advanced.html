<%page expression_filter="h"/>
<%inherit file="base.html" />
<%def name="online_help_token()"><% return "advanced" %></%def>
<%namespace name='static' file='static_content.html'/>
<%!
  from django.utils.translation import ugettext as _
  from contentstore import utils
  from openedx.core.djangolib.js_utils import (
      dump_js_escaped_json, js_escaped_string
  )
  from openedx.core.djangolib.markup import HTML, Text
%>
<%block name="title">${_("Advanced Settings")}</%block>
<%block name="bodyclass">is-signedin course advanced view-settings</%block>

<%block name="header_extras">
% for template_name in ["advanced_entry", "basic-modal", "modal-button", "validation-error-modal"]:
  <script type="text/template" id="${template_name}-tpl">
    <%static:include path="js/${template_name}.underscore" args="is_staff='true'" />
  </script>
% endfor
</%block>

<%block name="requirejs">
    require(["js/factories/settings_advanced"], function(SettingsAdvancedFactory) {

        var is_staff = ${is_staff['is_staff']};
        window.is_staff = is_staff;

        SettingsAdvancedFactory(
            ${advanced_dict | n, dump_js_escaped_json},
            "${advanced_settings_url | n, js_escaped_string}"
        );


    });
</%block>


<%block name="content">
<div class="wrapper-mast wrapper">
  <header class="mast has-subtitle">
    <h1 class="page-header">
      <small class="subtitle">${_("Settings")}</small>
      <span class="sr">&gt; </span>${_("Advanced Settings")}
    </h1>
  </header>
</div>

<div class="wrapper-content wrapper">
  <section class="content">
    <article class="content-primary" role="main">
      <form id="settings_advanced" class="settings-advanced" method="post" action="">

        <div class="message message-status confirm">
          ${_("Your policy changes have been saved.")}
        </div>

        <div class="message message-status error">
          ${_("There was an error saving your information. Please see below.")}
        </div>

        <section class="group-settings advanced-policies">
          <header>
            <h2 class="title-2">${_("Manual Policy Definition")}</h2>

          </header>

          <p class="instructions">${Text(_("{strong_start}Warning{strong_end}: Do not modify these policies unless you are familiar with their purpose.")).format(
            strong_start=HTML('<strong>'),
            strong_end=HTML('</strong>')
          )}</p>

          <div class="wrapper-options">
            <div class="wrapper-deprecated-setting">
              <input id="deprecated-settings" class="deprecated-settings-toggle" type="checkbox" name="Show Deprecated">
              <label for="deprecated-settings" class="deprecated-settings-label">${_("Show Deprecated Settings")}</label>
            </div>
          </div>

          <ul class="list-input course-advanced-policy-list enum">

          </ul>
        </section>
      </form>
    </article>
<!-- 스크립트를 추가 처리 함 시작
나중에 고도화 작업시 데이터베이스에서 가져와서 치리 하는 것으로 수정해야 함.
-->
% for dgree in difficult_degree_list:
    <%
    for key, val in difficult_degree_list.items():
        print val, key
        print val[0]
        print val[1]
        print val[2]

        print val[0][0]
        print val[0][1]

        print val[1][0]
        print val[1][1]

        print val[2][0]
        print val[2][1]

        pstr = """var degree = {'category':[{'code':'""" + val[0][0] + """', 'gettext': '""" + val[0][1] + """'}, """
        pstr += """{'code':'""" + val[1][0] + """', 'gettext': '""" + val[1][1] + """'}, """
        pstr += """{'code':'""" + val[2][0] + """', 'gettext': '""" + val[2][1] + """'},]};"""
    %>

<script type="text/javascript">

    //console.log("run dynamic javascript processing");

    ${ pstr | n, trim }

    var degree_js = function(){
        //console.log("run settings_advanced.html javascript calling degree_js");
        //var degree_val = document.getElementById("difficult-degree").options[document.getElementById("difficult-degree").selectedIndex].value;
        var key = 0;
        var difficult_degree_id = document.getElementById("selectfixid");
        //alert(difficult_degree_id);
        removeOptions(difficult_degree_id);
        input_difficult_degree(difficult_degree_id, 'category');

        var idx = $("#txtfixid").val();
        //$("#selectfixid").val(idx);
        if (idx == '"1"') {
            $("#selectfixid").val("1");
        } else if (idx == '"2"') {
            $("#selectfixid").val("2");
        } else if (idx == '"3"') {
            $("#selectfixid").val("3");
        } else {
            $("#selectfixid").val("");
        }

        readonlyCheck();
    }

    var input_difficult_degree = function(selectbox,p_info){
        //console.log("run settings_advanced.html javascript calling input_difficult_degree");
        var option = document.createElement("option");
        option.text = "강좌레벨";
        option.value = null;
        selectbox.appendChild(option);

        for(key in degree[p_info]){
            var row = degree[p_info][key];
            var option = document.createElement("option");
            option.text = row.gettext;
            option.value = row.code;
            selectbox.appendChild(option);
        }
    }

    var removeOptions = function(selectbox){
        //console.log("run settings_advanced.html javascript calling removeOptions");
        var i;
        for(i=selectbox.options.length-1;i>=0;i--){
            selectbox.remove(i);
        }
    }

    var readonlyCheck = function() {
        var p_middle_classfy = $(".cm-string").eq(1).text();
        //alert(p_middle_classfy);
        if (p_middle_classfy == '"intd_m"') {
            $(".cm-s-default").eq(2).css('display',"block");
        } else {
            $(".cm-s-default").eq(2).css('display',"none");
        }
    }

  </script>

% endfor
<!-- 스크립트를 추가 처리 함 끝 -->
    <aside class="content-supplementary" role="complementary">
      <div class="bit">
        <h3 class="title-3">${_("What do advanced settings do?")}</h3>
        <p>${_("Advanced settings control specific course functionality. On this page, you can edit manual policies, which are JSON-based key and value pairs that control specific course settings.")}</p>

        <p>${_("Any policies you modify here override all other information you've defined elsewhere in {studio_name}. Do not edit policies unless you are familiar with both their purpose and syntax.").format(studio_name=settings.STUDIO_SHORT_NAME)}</p>

        <p>${Text(_('{em_start}Note:{em_end} When you enter strings as policy values, ensure that you use double quotation marks (\") around the string. Do not use single quotation marks (\').')).format(
          em_start=HTML('<strong>'),
          em_end=HTML('</strong>')
        )}</p>
      </div>

      <div class="bit">
      % if context_course:
        <%
          details_url = utils.reverse_course_url('settings_handler', context_course.id)
          grading_url = utils.reverse_course_url('grading_handler', context_course.id)
          course_team_url = utils.reverse_course_url('course_team_handler', context_course.id)
        %>
      <h3 class="title-3">${_("Other Course Settings")}</h3>
        <nav class="nav-related" aria-label="${_('Other Course Settings')}">
          <ul>
            <li class="nav-item"><a href="${details_url}">${_("Details & Schedule")}</a></li>
            <li class="nav-item"><a href="${grading_url}">${_("Grading")}</a></li>
            <li class="nav-item"><a href="${course_team_url}">${_("Course Team")}</a></li>
            <li class="nav-item"><a href="${utils.reverse_course_url('group_configurations_list_handler', context_course.id)}">${_("Group Configurations")}</a></li>
          </ul>
        </nav>
      % endif
      </div>
    </aside>
  </section>
</div>
</%block>
